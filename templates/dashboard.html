{% extends 'base.html' %}

{% block head %}
  <!-- Load chart.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.2.1/Chart.js"></script>
{% endblock %}

{% block body %}
  <!-- Bootstrap div layout -->
  <div class="container-fluid">
    <div class="row" style="height: 20px">
    </div>
    <div class="row">
      <div class="col-4">
        <div id="map_details">
          <h2>Dashboard</h2>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-7">
        <div class="place_chart">
          <h2 id="dashboard-header">Top 10 Places</h2>
          <canvas id="barChart-places"></canvas>
        </div>
      </div>      
      <div class="col-5">
        <div class="place_types_chart">
          <h2 id="dashboard-header">Top 5 Place Types</h2>
          <canvas id="donutChart-place-types"></canvas>
          <div id="donutLegend-place-types" class="chart-legend"></div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-7">
        <h2 id="dashboard-header">User Statistics</h2>
        <h3 id="dashboard-par-header"> Total Users: {{ total_users }}</h3>
        <h3 id="dashboard-par-header"> Total Maps: {{ total_maps }}</h3>
        <h3 id="dashboard-par-header"> Total Places Mapped: {{ total_places_mapped }}</h3>
        <h3 id="dashboard-par-header"> Average Maps / User: {{ avg_maps_per_user }}</h3>
        <h3 id="dashboard-par-header"> Average Places / Map: {{ avg_places_mapped }}</h3>

      </div>
    </div>

  </div>
  <!-- Javascript code -->
  <script>
    const options = {
      responsive: true
    };

    // Make Bar of top 10 places
    let ctx_bar = $("#barChart-places").get(0).getContext("2d");

    $.get("/place_statistics.json", function (data) {
      var myBarChart = new Chart(ctx_bar, {
                                            type: 'bar',
                                            data: data,
                                            options: {
                                                      legend: { display: false },
                                                      title: {
                                                        display: false,
                                                        text: 'Popular mapped places'
                                                        },
                                                      scales: {
                                                        yAxes: [{
                                                          ticks: {
                                                            beginAtZero: true
                                                            }
                                                        }]
                                                      }
                                                  }
                                            }); 
      }); 
    
    // Make Donut Chart of top 5 place types
    let ctx_donut = $("#donutChart-place-types").get(0).getContext("2d");

    $.get("/place_type_statistics.json", function (data) {
       myDonutChart = new Chart(ctx_donut, {
                                              type: 'doughnut',
                                              data: data,
                                              options: options
                                            });
      $('#donutLegend-place-types').html(myDonutChart.generateLegend());
    });



  </script>
{% endblock %}